# Walleca 要件定義書  
（サブスク・レシート支出管理アプリケーション）

---

## 1. 研究背景・目的

### 1.1 背景
近年、動画配信・音楽配信・クラウドサービス等のサブスクリプションサービスの増加により、  
個人の支出構造は「固定費（サブスク）」と「変動費（日常支出）」に分かれて複雑化している。

既存の家計簿アプリは入力負荷が高く継続が難しい一方、  
サブスク管理アプリは日常支出を扱えないという課題がある。

### 1.2 目的
本研究では、

- レシート画像による支出管理
- サブスクリプション（固定費）管理
- Notion のような柔軟なデータ閲覧（ビュー切替）

を統合した **Web / アプリ両対応の個人支出管理システム**を設計・実装する。

また、  
**X や Notion に代表される「API中心・クライアント分離型アーキテクチャ」**を採用し、  
拡張性・保守性を重視した設計を行うことを研究上の特徴とする。

---

## 2. システム概要

### 2.1 システム名
**Walleca**

### 2.2 対象ユーザー
- 個人ユーザー（学生・社会人）
- 主に日本国内利用を想定
- 単一ユーザー利用（共有家計は対象外）

### 2.3 提供形態
- Web（ブラウザ）
- モバイルアプリ（iOS / Android）
- 自宅サーバーでの運用を前提

---

## 3. 設計方針

### 3.1 基本思想
- クライアント（Web/アプリ）は表示・入力に専念
- 業務ロジックはすべて API サーバー側に集約
- データを中心に据え、「ビュー」で見せ方を変える（Notion型）

### 3.2 コスト方針
- クラウド有料サービスに依存しない
- OCR はオンプレミス（Tesseract）を使用
- 画像は自宅サーバーのローカルストレージに保存

---

## 4. 機能要件

### 4.1 認証・ユーザー管理
- ユーザー登録・ログイン機能
- Web / アプリ間で同一アカウントのデータ同期
- 単一ユーザー前提（権限管理・共有機能は対象外）

---

### 4.2 レシート管理機能（必須）

#### 4.2.1 レシート登録
- 画像アップロード（Web）
- カメラ撮影・画像選択（アプリ）
- 対応形式：JPEG / PNG
- ファイルサイズ制限あり

#### 4.2.2 OCR 処理
- OCR エンジン：Tesseract（オンプレミス）
- 非同期処理（キュー方式）
- OCR 状態管理  
  - pending / success / failed

#### 4.2.3 抽出情報
OCR により以下を抽出する（精度は100%を要求しない）：

- 店名（merchant）
- 購入日（date）
- 合計金額（total）
- OCR全文テキスト（raw_text）

※ 抽出失敗時でも、ユーザーが手動入力して登録可能とする。

#### 4.2.4 編集・確定
- OCR結果をユーザーが確認・修正できる
- 確定後、支出データ（Transaction）を生成

---

### 4.3 支出管理（Transaction DB）

#### 4.3.1 基本情報
- 支出 / 収入 / 調整 の区別
- 金額
- 日付
- 店名
- 紐づくレシート（任意）

#### 4.3.2 可変プロパティ（Notion型）
以下は自由に追加・変更できるプロパティとして扱う：

- カテゴリ
- タグ（複数）
- 支払方法
- メモ

※ JSON 形式で保持し、将来の拡張に対応する。

---

### 4.4 ビュー機能（Notionライク）

#### 4.4.1 ビューの概念
- データ（Transaction）とは独立した「表示定義」
- ユーザーが複数のビューを作成可能

#### 4.4.2 表示形式
- リスト表示
- カレンダー表示

#### 4.4.3 機能
- フィルタ（期間 / カテゴリ / タグ 等）
- ソート（日付 / 金額）
- グループ化（月別 / カテゴリ別）

---

### 4.5 サブスクリプション管理

#### 4.5.1 登録項目
- サービス名
- 支払金額
- 支払周期（月 / 年）
- 次回支払日
- カテゴリ
- 状態（有効 / 停止 / 解約）

#### 4.5.2 集計
- 月額換算合計金額
- カテゴリ別合計

---

### 4.6 通知機能（最低限）
- サブスク支払日の通知
- アプリ内通知を基本とする
- プッシュ通知は拡張扱い

---

### 4.7 検索・エクスポート
- 店名・メモ・OCR全文検索
- CSV エクスポート（支出 / サブスク）

---

## 5. 非機能要件

### 5.1 性能
- 個人利用・少人数デモを想定
- 同時利用数：1〜5人程度

### 5.2 信頼性
- OCR処理は同時実行数を制限
- サーバーダウンを防ぐ構成

### 5.3 セキュリティ
- HTTPS通信
- レシート画像は認証ユーザーのみアクセス可能
- 定期バックアップ実施

---

## 6. システム構成

### 6.1 クライアント
- Flutter（Web / iOS / Android）

### 6.2 サーバー
- API：Node.js（TypeScript）
- DB：PostgreSQL
- キャッシュ / キュー：Redis
- OCR：Tesseract
- 画像保存：ローカルストレージ

### 6.3 運用
- 自宅サーバー
- Docker Compose による構成管理

---

## 7. 対象外（本研究では扱わない）
- 銀行・クレジットカード連携
- レシート自動分類AIの高精度化
- 複数ユーザーでの家計共有
- 商用運用・大規模スケール

---

## 8. 研究上の特徴・評価ポイント
- Notion型データモデルとビュー設計
- OCR失敗を前提としたUX設計
- Web / アプリ共通API設計
- 低コスト環境での実用的システム構築

---

## 9. 今後の拡張可能性
- クラウドOCRへの差し替え
- クラウドストレージ対応
- レポート自動生成
- 共有・共同家計機能

